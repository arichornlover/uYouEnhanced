#import "uYouPlus.h"

typedef struct {
    int version;
    NSString *appVersion;
} VersionMapping;

static VersionMapping versionMappings[] = {
    {0, @"20.44.2"},
    {1, @"20.43.3"},
    {2, @"20.42.3"},
    {3, @"20.41.5"},
    {4, @"20.41.4"},
    {5, @"20.40.4"},
    {6, @"20.39.6"},
    {7, @"20.39.5"},
    {8, @"20.39.4"},
    {9, @"20.38.4"},
    {10, @"20.38.3"},
    {11, @"20.37.5"},
    {12, @"20.37.3"},
    {13, @"20.36.3"},
    {14, @"20.35.2"},
    {15, @"20.34.2"},
    {16, @"20.33.2"},
    {17, @"20.32.5"},
    {18, @"20.32.4"},
    {19, @"20.31.6"},
    {20, @"20.31.5"},
    {21, @"20.30.5"},
    {22, @"20.29.3"},
    {23, @"20.28.2"},
    {24, @"20.26.7"},
    {25, @"20.25.4"},
    {26, @"20.24.5"},
    {27, @"20.24.4"},
    {28, @"20.23.3"},
    {29, @"20.22.1"},
    {30, @"20.21.6"},
    {31, @"20.20.7"},
    {32, @"20.20.5"},
    {33, @"20.19.3"},
    {34, @"20.19.2"},
    {35, @"20.18.5"},
    {36, @"20.18.4"},
    {37, @"20.16.7"},
    {38, @"20.15.1"},
    {39, @"20.14.2"},
    {40, @"20.13.5"},
    {41, @"20.12.4"},
    {42, @"20.11.6"},
    {43, @"20.10.4"},
    {44, @"20.10.3"},
    {45, @"20.09.3"},
    {46, @"20.08.3"},
    {47, @"20.07.6"},
    {48, @"20.06.03"},
    {49, @"20.05.4"},
    {50, @"20.03.1"},
    {51, @"20.03.02"},
    {52, @"20.02.3"},
    {53, @"19.49.7"},
    {54, @"19.49.5"},
    {55, @"19.49.3"},
    {56, @"19.47.7"},
    {57, @"19.46.3"},
    {58, @"19.45.4"},
    {59, @"19.44.4"},
    {60, @"19.43.2"},
    {61, @"19.42.1"},
    {62, @"19.41.3"},
    {63, @"19.40.4"},
    {64, @"19.39.1"},
    {65, @"19.38.2"},
    {66, @"19.37.2"},
    {67, @"19.36.1"},
    {68, @"19.35.3"},
    {69, @"19.34.2"},
    {70, @"19.33.2"},
    {71, @"19.32.8"},
    {72, @"19.32.6"},
    {73, @"19.31.4"},
    {74, @"19.30.2"},
    {75, @"19.29.1"},
    {76, @"19.28.1"},
    {77, @"19.26.5"},
    {78, @"19.25.4"},
    {79, @"19.25.3"},
    {80, @"19.24.3"},
    {81, @"19.24.2"},
    {82, @"19.23.3"},
    {83, @"19.22.6"},
    {84, @"19.22.3"},
    {85, @"19.21.3"},
    {86, @"19.21.2"},
    {87, @"19.20.2"},
    {88, @"19.19.7"},
    {89, @"19.19.5"},
    {90, @"19.18.2"},
    {91, @"19.17.2"},
    {92, @"19.16.3"},
    {93, @"19.15.1"},
    {94, @"19.14.3"},
    {95, @"19.14.2"},
    {96, @"19.13.1"},
    {97, @"19.12.3"},
    {98, @"19.10.7"},
    {99, @"19.10.6"},
    {100, @"19.10.5"},
    {101, @"19.09.4"},
    {102, @"19.09.3"},
    {103, @"19.08.2"},
    {104, @"19.07.5"},
    {105, @"19.07.4"},
    {106, @"19.06.2"},
    {107, @"19.05.5"},
    {108, @"19.05.3"},
    {109, @"19.04.3"},
    {110, @"19.03.2"},
    {111, @"19.02.1"},
    {112, @"19.01.1"}
};

static int appVersionSpoofer() {
    return [[NSUserDefaults standardUserDefaults] integerForKey:@"versionSpoofer"];
}

static BOOL isVersionSpooferEnabled() {
    return IS_ENABLED(@"enableVersionSpoofer_enabled");
}

static NSString* getAppVersionForSpoofedVersion(int spoofedVersion) {
    for (int i = 0; i < sizeof(versionMappings) / sizeof(versionMappings[0]); i++) {
        if (versionMappings[i].version == spoofedVersion) {
            return versionMappings[i].appVersion;
        }
    }
    return nil;
}

%hook YTVersionUtils
+ (NSString *)appVersion {
    if (!isVersionSpooferEnabled()) {
        return %orig;
    }
    int spoofedVersion = appVersionSpoofer();
    NSString *appVersion = getAppVersionForSpoofedVersion(spoofedVersion);
    return appVersion ? appVersion : %orig;
}
%end
